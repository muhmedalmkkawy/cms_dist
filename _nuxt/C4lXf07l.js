import{R as I,i as v,S as f,U as L,V as _,W as $,K as A,X as E,Y as M}from"./BoyXQbIz.js";const k=I("authStore",()=>{const s=v(null);return{user:s,handleUserData:t=>{s.value=t}}},{persist:{storage:{getItem:s=>{const e=f(s,{maxAge:86400});return e.value?JSON.parse(e.value):null},setItem:(s,e)=>{const t=f(s,{maxAge:86400});t.value=JSON.stringify(e)},removeItem:s=>{const e=f(s);e.value=null}}}});function D(){const s=L(),e=_(),t=(a,o,h,g=2e3)=>{s.add({severity:a,summary:o,detail:h,life:g})};return{toast:s,showErrorToast:a=>{const o=e?.lang=="ar"?"حدث خطأ":"Error";t("error",o,a)},showSuccessToast:a=>{const o=e?.lang=="ar"?"تمت بـنجاح":"Success";t("success",o,a)},showInfoToast:a=>{const o=e?.lang=="ar"?"معلومة":"Info";t("info",o,a)},showWarnToast:a=>{const o=e?.lang=="ar"?"تحذير":"Warning";t("warn",o,a)}}}const O=(s,e={})=>{const t=k()?.userData?.token||JSON.parse(window.sessionStorage.getItem("authStore"))?.token,l=_().lang,n=$(),w=e.baseURL||n.public.apiBase,m=n.public.secretKey,a={...s?{authorization:`Bearer ${t}`}:{},"accept-language":l||"en",secretKey:m,...e.headers};return{baseURL:w,headers:a,response_type:"json",...e}},R=async(s,e,t={},l)=>{try{return{data:await $fetch(s,{...O(e,t),method:l,body:t.body||void 0}),error:null}}catch(n){return console.error(`Error fetching data from ${s}:`,n),{data:null,error:n}}},W=(s,e,t={})=>R(s,e,t,"GET"),z=(s,e,t,l="POST",n={})=>R(s,e,{...n,body:t},l);function N(){const s=_(),e=k();A();const t=M(),l=E(),{showErrorToast:n,showSuccessToast:w,showInfoToast:m,showWarnToast:a}=D(),o=r=>{setTimeout(()=>{r=="reload_page"?t.go(0):t.push(l(r))},500)},h=(r,c)=>{s.switchLoading(!1),r=="success"?w(c):r=="info"?m(c):r=="warn"?a(c):n(c)},g=v(null),b=async(r,c,p,S)=>{s.switchLoading(!0),g.value=null,console.log(r);const{data:u,error:i}=await W(`${r}${c?`${r.includes("?")?"&":"?"}page=${c}`:""}`,p);i?(h("error",i?.response?._data?.message),(i?.response?._data?.status=="unauthenticated"||i?.response?._data?.status=="unauthorized"||i?.response?._data?.status=="not_approved"||i?.response?._data?.status=="blocked")&&(setTimeout(()=>{location.reload()},500),f("authStore").value="",window.sessionStorage.clear())):(u.status=="success"?g.value=u:(u.status=="unauthenticated"||u.status=="unauthorized"||u.status=="not_approved"||u.status=="blocked")&&(setTimeout(()=>{location.reload()},500),f("authStore").value="",window.sessionStorage.clear()),S&&h(u?.status,u?.message),s.switchLoading(!1))},y=v(null);return{getMethod:b,getResult:g,submitMethod:async(r,c,p,S,u,i)=>{s.switchLoading(!0);const{data:T,error:d}=await z(r,c,p,S);d?(h("error",d?.response?._data?.message),d?.response?._data?.status=="unauthenticated"||d?.response?._data?.status=="unauthorized"||d?.response?._data?.status=="not_approved"||d?.response?._data?.status=="blocked"?(f("authStore").value="",window.sessionStorage.clear(),setTimeout(()=>{o("/auth/login")},500)):d?.response?._data?.status=="needActive"&&setTimeout(()=>{o("/auth/activation_code")},500)):(u&&o(u),i&&b(i,"",!!e,!1),y.value=T,h(T?.status,T?.message),s.switchLoading(!1))},submitResult:y,showErrorToast:n,handleNextRoute:o}}export{D as a,N as u};
